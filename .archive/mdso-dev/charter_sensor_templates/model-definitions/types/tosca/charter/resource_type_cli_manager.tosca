"$schema"   = "http://cyaninc.com/json-schemas/tosca-lite-v1/definition-module#"
title       = "CLI Manager"
package     = charter
version     = "1.0"
description = """
This document defines as a CLI Manager allow commands only if called by CPE Activator or 
    Managed Services Activator. If not, still allow show commands.
"""
authors     = []

imports {

}

resourceTypes {
    CLIManager {
        derivedFrom = tosca.resourceTypes.Root
        title = CLI Manager
        description = """
        - Extended from charter.resourceTypes.BaseResource
        - The main entry point for Charter's systems for creating a Service Mapper resource.
        - This Resource Definition only requires the Charter Circuit ID 
        - For service types like ELINE, ELAN, FIA, etc.
        """

        properties {
            fqdn {
                title = "fqdn"
                description = "domain of the device"
                type = string
                optional = true
            }
            ipAddress {
                title = "ip address"
                description = "ip address of the device"
                type = string
                optional = false
            }
            configuration {
                title = "configuration"
                description = "full configuration for the device"
                type = array
                optional = false
            }
            ignore_errors {
                title = "ignore errors"
                description = "run through all commands even if one errors in the middle."
                type = boolean
                default = false
                optional = true
            }
            banner {
                title = "banner flag"
                description = "is it banner configuration?"
                type = boolean
                default = false
                optional = true
                updatable = true
            }
            additionalAttributes {
                title = "Additional Attributes"
                description = "Additional Attributes"
                propertyType = tosca.propertyTypes.AdditionalAttributes
                optional = true
            }
            operation {
                title = "Operation from which this CLI_Manager was invoked"
                description = """
                This property influences the CLI_Manager behavior when choosing which
                commands to allow.
                """
                optional = true
                updatable = false
                type = string
                enum = [
                    "MANAGED_SERVICES_ACTIVATION",
                    "CPE_ACTIVATION"
                ]
            }
              output_results {
                title = "Command Results"
                description = "results of the commands sent by CLIManager. Includes a status of 'start', 'partial', 'partial with kill' or 'full'"
                type = object
                output = true
                items.type = object
            }
        }
    }
}

serviceTemplates {
    CLIManager {
        title = CLI Manager
        description = "CLI Manager"
        implements = charter.resourceTypes.CLIManager

        plans {

            activate {
                type = remote
                language = python
                path = "scripts.CLIManager.CLIManager.Activate"
            }
            terminate {
                type = remote
                language = python
                path = "scripts.CLIManager.CLIManager.Terminate"
            }
        }

        output {
            // Set the backward property based on what the activate plan returns.
            output_results = { getAttr = [ activate, output ] }
            }
    }
    
}
