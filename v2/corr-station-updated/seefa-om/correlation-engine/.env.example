# Correlation Engine Configuration
# Copy this file to .env and update with your values

# ============================================================================
# Server Settings
# ============================================================================
PORT=8080
LOG_LEVEL=info  # debug, info, warning, error

# ============================================================================
# Correlation Settings
# ============================================================================
CORR_WINDOW_SECONDS=60
MAX_BATCH_SIZE=5000
MAX_QUEUE_SIZE=10000
MAX_CORRELATION_HISTORY=10000

# Advanced Correlation Features
ENABLE_TRACE_SYNTHESIS=true
CORRELATION_CONFIDENCE_THRESHOLD=0.5
TRACE_SYNTHESIS_WINDOW_SECONDS=60

# ============================================================================
# Backend URLs
# ============================================================================
LOKI_URL=http://loki:3100/loki/api/v1/push
TEMPO_GRPC_ENDPOINT=tempo:4317
TEMPO_HTTP_ENDPOINT=http://tempo:4318
PROMETHEUS_PUSHGATEWAY=  # Optional

# ============================================================================
# Export Settings
# ============================================================================
EXPORT_RETRY_ATTEMPTS=3
EXPORT_RETRY_DELAY=1.0
EXPORT_TIMEOUT=10.0
ENABLE_CIRCUIT_BREAKER=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60

# ============================================================================
# Authentication
# ============================================================================
ENABLE_BASIC_AUTH=false
BASIC_AUTH_USER=admin
BASIC_AUTH_PASS=changeme

# ============================================================================
# CORS
# ============================================================================
ALLOW_ORIGINS=*  # Comma-separated list or "*" for all

# ============================================================================
# Datadog (Optional Dual-Write)
# ============================================================================
DATADOG_API_KEY=  # Leave empty to disable
DATADOG_SITE=datadoghq.com

# ============================================================================
# Deployment
# ============================================================================
DEPLOYMENT_ENV=dev  # dev, staging, prod

# ============================================================================
# Self-Observability
# ============================================================================
ENABLE_SELF_OBSERVABILITY=true
SELF_OBSERVABILITY_DATADOG_ENABLED=false
SELF_OBSERVABILITY_METRIC_INTERVAL_MS=60000

# ============================================================================
# MDSO Client Settings
# ============================================================================
MDSO_BASE_URL=https://mdso.example.com
MDSO_USERNAME=admin
MDSO_PASSWORD=changeme
MDSO_VERIFY_SSL=true  # Set to false only for dev/testing
MDSO_SSL_CA_BUNDLE=  # Optional path to CA bundle
MDSO_TIMEOUT=30.0
MDSO_TOKEN_EXPIRY_SECONDS=3600  # 1 hour

# ============================================================================
# HTTP Client Settings
# ============================================================================
HTTP_VERIFY_SSL=true
HTTP_MAX_CONNECTIONS=100
HTTP_MAX_KEEPALIVE_CONNECTIONS=20

# ============================================================================
# Queue Settings
# ============================================================================
QUEUE_RETRY_ATTEMPTS=3
QUEUE_RETRY_DELAY=0.1
ENABLE_QUEUE_METRICS=true

# ============================================================================
# Security - Request Size Limits
# ============================================================================
MAX_REQUEST_BODY_SIZE=10485760  # 10MB in bytes
MAX_PROTOBUF_SIZE=10485760      # 10MB in bytes
MAX_JSON_SIZE=10485760          # 10MB in bytes

# ============================================================================
# State Management & Horizontal Scaling
# ============================================================================
# IMPORTANT: Enable Redis for horizontal scaling across multiple instances
# When USE_REDIS_STATE=false: Single instance only (in-memory state)
# When USE_REDIS_STATE=true: Multiple instances can share state via Redis

USE_REDIS_STATE=false  # Set to true for horizontal scaling
REDIS_URL=redis://localhost:6379  # Redis connection URL
REDIS_MAX_CONNECTIONS=50  # Max connections in pool
REDIS_KEY_PREFIX=corr:  # Prefix for all Redis keys

# Correlation State Settings
CORRELATION_TTL_SECONDS=3600  # TTL for correlations (1 hour)
CORRELATION_WINDOW_SECONDS=60  # Time window for correlation
MAX_CORRELATION_AGE_HOURS=24  # Max age before cleanup

# How to enable horizontal scaling:
# 1. Deploy Redis cluster: docker run -d -p 6379:6379 redis:7-alpine
# 2. Set USE_REDIS_STATE=true in this file
# 3. Deploy multiple correlation engine instances
# 4. Use load balancer to distribute traffic (see HORIZONTAL_SCALING.md)
