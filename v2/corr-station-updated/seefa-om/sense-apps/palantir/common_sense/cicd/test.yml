
variables:
  GIT_SUBMODULE_STRATEGY: normal

test:
  stage: test
  tags:
    - test
  script:
    - pip3 install --upgrade pip
    - pip3 install -r requirements.txt
    - pytest -m "unittest" --cov=common_sense --cov-report xml --cov-report=term-missing --junitxml=test.xml tests
  except:
    - master

test_master:
  stage: test
  tags:
    - test
  script:
    - pip3 install --upgrade pip
    - pip3 install -r requirements.txt
    - pytest -m "unittest" --cov=common_sense --cov-report xml --cov-report=term-missing --junitxml=test.xml tests
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  artifacts:
    paths:
      - /builds/service-engineering-automation/sense/common_sense/test.xml
      - /builds/service-engineering-automation/sense/common_sense/coverage.xml
    reports:
      coverage_report:
        coverage_format: cobertura
        path: /builds/service-engineering-automation/sense/common_sense/coverage.xml
    expire_in: 1 week
  only:
    - master