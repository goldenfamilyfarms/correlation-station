# python container
FROM python:3.11

# Bring in --build-arg values from common_sense/cicd/build_image.yml docker build
ARG SNMP_COMMUNITY_STRING
ARG SNMP_COMMUNITY_STRING_SKELLY
ARG SNMP_PUBLIC_STRING
ARG SNMP_PUBLIC_STRING_SKELLY
ARG IPC_PASS_SKELLY
ARG REMEDY_USER
ARG REMEDY_PASS
ARG REMEDY_PASS_SKELLY
ARG MDSO_USER_PROD
ARG MDSO_PASS_PROD
ARG MDSO_PASS_PROD_SKELLY
ARG MDSO_USER
ARG MDSO_PASS
ARG MDSO_PASS_SKELLY
ARG ODIN_USER
ARG ODIN_PASS
ARG ODIN_PASS_SKELLY
ARG ODIN_TOKEN
ARG ODIN_TOKEN_SKELLY
ARG NETWORK_LOGIN_USER
ARG NETWORK_LOGIN_PASS
ARG NETWORK_LOGIN_PASS_SKELLY
ARG SENSE_SWAGGER_USER
ARG SENSE_SWAGGER_PASS
ARG SENSE_SWAGGER_PASS_SKELLY
ARG SALESFORCE_BASE_URL
ARG SALESFORCE_EMAIL
ARG SALESFORCE_PASS
ARG SALESFORCE_PASS_SKELLY
ARG SALESFORCE_TOKEN
ARG SALESFORCE_TOKEN_SKELLY
ARG TACACS_USER
ARG TACACS_PASS
ARG TACACS_PASS_SKELLY
ARG ESET_USER
ARG ESET_PASS
ARG ESET_PASS_SKELLY
ARG ISE_USER
ARG ISE_PASS
ARG ISE_PASS_SKELLY
ARG ISE_STATIC_KEY
ARG ISE_STATIC_KEY_SKELLY
ARG ISE_STATIC_KEY_ADVA
ARG ISE_STATIC_KEY_ADVA_SKELLY
ARG ISE_STATIC_KEY_CIENA
ARG ISE_STATIC_KEY_CIENA_SKELLY
ARG ISE_STATIC_KEY_CISCO
ARG ISE_STATIC_KEY_CISCO_SKELLY
ARG ISE_STATIC_KEY_JUNIPER
ARG ISE_STATIC_KEY_JUNIPER_SKELLY
ARG ISE_STATIC_KEY_NOKIA
ARG ISE_STATIC_KEY_NOKIA_SKELLY
ARG ISE_STATIC_KEY_RAD
ARG ISE_STATIC_KEY_RAD_SKELLY
ARG ISE_STATIC_KEY_ALCATEL
ARG ISE_STATIC_KEY_ALCATEL_SKELLY
ARG SENSE_EMAIL_NAME
ARG SENSE_EMAIL_PASS
ARG SENSE_EMAIL_PASS_SKELLY
ARG SENSE_EMAIL_SERVER
ARG SENSE_EMAIL_PORT
ARG MDSO_PROD_URL
ARG MDSO_BASE_URL
ARG DENODO_BASE_URL
ARG HYDRA_BASE_URL
ARG NICE_BASE_URL
ARG ODIN_BASE_URL
ARG LIGHT_TEST_URL
ARG BLACKLIST_IP_SERVICE_URL
ARG ESET_BASE_URL
ARG ISE_EAST_URL_PAN11
ARG ISE_EAST_URL_PAN21
ARG ISE_WEST_URL_PAN11
ARG ISE_WEST_URL_PAN21
ARG ISE_SOUTH_URL_PAN11
ARG ISE_SOUTH_URL_PAN21
ARG NDOS_BASE_URL
ARG SEEK_BASE_URL
ARG IPC_USER
ARG IPC_PASS
ARG GRANITE_BASE_URL
ARG ARIN_CREATE_BASE_URL
ARG REMEDY_BASE_URL
ARG REMEDY_SERVER
ARG SENSE_BASE_URL
ARG WHOIS_BASE_URL
ARG ARIN_API_KEY
ARG ARIN_API_KEY_SKELLY
ARG PALANTIR_GENERAL_HYDRA_KEY
ARG PALANTIR_GENERAL_HYDRA_KEY_SKELLY
ARG PALANTIR_SPIRENT_HYDRA_KEY
ARG PALANTIR_SPIRENT_HYDRA_KEY_SKELLY
ARG PALANTIR_MNE_HYDRA_KEY
ARG PALANTIR_MNE_HYDRA_KEY_SKELLY
ARG PALANTIR_TID_HYDRA_KEY
ARG PALANTIR_TID_HYDRA_KEY_SKELLY
ARG PALANTIR_IPC_HYDRA_KEY
ARG PALANTIR_IPC_HYDRA_KEY_SKELLY
ARG PALANTIR_HYDRA_STAGIUS_KEY
ARG PALANTIR_HYDRA_STAGIUS_KEY_SKELLY
ARG USAGE_DESIGNATION
ARG SENSE_TEST_SWAGGER_USER
ARG SENSE_TEST_SWAGGER_PASS
ARG SENSE_TEST_SWAGGER_PASS_SKELLY

# set env variables
ENV SENSE_PALANTIR_CONFIG="/palantir/palantir_app/test_config.py"
# from CI variables
ENV SNMP_COMMUNITY_STRING=${SNMP_COMMUNITY_STRING} \
    SNMP_COMMUNITY_STRING_SKELLY=${SNMP_COMMUNITY_STRING_SKELLY} \
    SNMP_PUBLIC_STRING=${SNMP_PUBLIC_STRING} \
    SNMP_PUBLIC_STRING_SKELLY=${SNMP_PUBLIC_STRING_SKELLY} \
    IPC_USER=${IPC_USER} \
    IPC_PASS=${IPC_PASS} \
    IPC_PASS_SKELLY=${IPC_PASS_SKELLY} \
    REMEDY_USER=${REMEDY_USER} \
    REMEDY_PASS=${REMEDY_PASS} \
    REMEDY_PASS_SKELLY=${REMEDY_PASS_SKELLY} \
    MDSO_USER_PROD=${MDSO_USER_PROD} \
    MDSO_USER=${MDSO_USER} \
    MDSO_PASS_PROD=${MDSO_PASS_PROD} \
    MDSO_PASS_PROD_SKELLY=${MDSO_PASS_PROD_SKELLY} \
    MDSO_PASS=${MDSO_PASS} \
    MDSO_PASS_SKELLY=${MDSO_PASS_SKELLY} \
    ODIN_USER=${ODIN_USER} \
    ODIN_PASS=${ODIN_PASS} \
    ODIN_PASS_SKELLY=${ODIN_PASS_SKELLY} \
    ODIN_TOKEN=${ODIN_TOKEN} \
    ODIN_TOKEN_SKELLY=${ODIN_TOKEN_SKELLY} \
    NETWORK_LOGIN_USER=${NETWORK_LOGIN_USER} \
    NETWORK_LOGIN_PASS=${NETWORK_LOGIN_PASS} \
    NETWORK_LOGIN_PASS_SKELLY=${NETWORK_LOGIN_PASS_SKELLY} \
    SENSE_SWAGGER_USER=${SENSE_SWAGGER_USER} \
    SENSE_SWAGGER_PASS=${SENSE_SWAGGER_PASS} \
    SENSE_SWAGGER_PASS_SKELLY=${SENSE_SWAGGER_PASS_SKELLY} \
    SALESFORCE_EMAIL=${SALESFORCE_EMAIL} \
    SALESFORCE_BASE_URL=${SALESFORCE_BASE_URL} \
    SALESFORCE_PASS=${SALESFORCE_PASS} \
    SALESFORCE_PASS_SKELLY=${SALESFORCE_PASS_SKELLY} \
    SALESFORCE_TOKEN=${SALESFORCE_TOKEN} \
    SALESFORCE_TOKEN_SKELLY=${SALESFORCE_TOKEN_SKELLY} \
    TACACS_USER=${TACACS_USER} \
    TACACS_PASS=${TACACS_PASS} \
    TACACS_PASS_SKELLY=${TACACS_PASS_SKELLY} \
    ESET_USER=${ESET_USER} \
    ESET_PASS=${ESET_PASS} \
    ESET_PASS_SKELLY=${ESET_PASS_SKELLY} \
    ISE_USER=${ISE_USER} \
    ISE_PASS=${ISE_PASS} \
    ISE_PASS_SKELLY=${ISE_PASS_SKELLY} \
    ISE_STATIC_KEY=${ISE_STATIC_KEY} \
    ISE_STATIC_KEY_SKELLY=${ISE_STATIC_KEY_SKELLY} \
    ISE_STATIC_KEY_ADVA=${ISE_STATIC_KEY_ADVA} \
    ISE_STATIC_KEY_ADVA_SKELLY=${ISE_STATIC_KEY_ADVA_SKELLY} \
    ISE_STATIC_KEY_RAD=${ISE_STATIC_KEY_RAD} \
    ISE_STATIC_KEY_RAD_SKELLY=${ISE_STATIC_KEY_RAD_SKELLY} \
    ISE_STATIC_KEY_CIENA=${ISE_STATIC_KEY_CIENA} \
    ISE_STATIC_KEY_CIENA_SKELLY=${ISE_STATIC_KEY_CIENA_SKELLY} \
    ISE_STATIC_KEY_CISCO=${ISE_STATIC_KEY_CISCO} \
    ISE_STATIC_KEY_CISCO_SKELLY=${ISE_STATIC_KEY_CISCO_SKELLY} \
    ISE_STATIC_KEY_JUNIPER=${ISE_STATIC_KEY_JUNIPER} \
    ISE_STATIC_KEY_JUNIPER_SKELLY=${ISE_STATIC_KEY_JUNIPER_SKELLY} \
    ISE_STATIC_KEY_NOKIA=${ISE_STATIC_KEY_NOKIA} \
    ISE_STATIC_KEY_NOKIA_SKELLY=${ISE_STATIC_KEY_NOKIA_SKELLY} \
    ISE_STATIC_KEY_ALCATEL=${ISE_STATIC_KEY_ALCATEL} \
    ISE_STATIC_KEY_ALCATEL_SKELLY=${ISE_STATIC_KEY_ALCATEL_SKELLY} \
    SENSE_EMAIL_NAME=${SENSE_EMAIL_NAME} \
    SENSE_EMAIL_PASS=${SENSE_EMAIL_PASS} \
    SENSE_EMAIL_PASS_SKELLY=${SENSE_EMAIL_PASS_SKELLY} \
    SENSE_EMAIL_SERVER=${SENSE_EMAIL_SERVER} \
    SENSE_EMAIL_PORT=${SENSE_EMAIL_PORT} \
    MDSO_PROD_URL=${MDSO_PROD_URL} \
    MDSO_BASE_URL=${MDSO_BASE_URL} \
    DENODO_BASE_URL=${DENODO_BASE_URL} \
    HYDRA_BASE_URL=${HYDRA_BASE_URL} \
    IPC_BASE_URL=${IPC_BASE_URL} \
    NICE_BASE_URL=${NICE_BASE_URL} \
    ODIN_BASE_URL=${ODIN_BASE_URL} \
    LIGHT_TEST_URL=${LIGHT_TEST_URL} \
    BLACKLIST_IP_SERVICE_URL=${BLACKLIST_IP_SERVICE_URL} \
    ESET_BASE_URL=${ESET_BASE_URL} \
    ISE_EAST_URL_PAN11=${ISE_EAST_URL_PAN11} \
    ISE_EAST_URL_PAN21=${ISE_EAST_URL_PAN21} \
    ISE_WEST_URL_PAN11=${ISE_WEST_URL_PAN11} \
    ISE_WEST_URL_PAN21=${ISE_WEST_URL_PAN21} \
    ISE_SOUTH_URL_PAN11=${ISE_SOUTH_URL_PAN11} \
    ISE_SOUTH_URL_PAN21=${ISE_SOUTH_URL_PAN21} \
    NDOS_BASE_URL=${NDOS_BASE_URL} \
    SEEK_BASE_URL=${SEEK_BASE_URL} \
    GRANITE_BASE_URL=${GRANITE_BASE_URL} \
    ARIN_CREATE_BASE_URL=${ARIN_CREATE_BASE_URL} \
    REMEDY_BASE_URL=${REMEDY_BASE_URL} \
    REMEDY_SERVER=${REMEDY_SERVER} \
    SENSE_BASE_URL=${SENSE_BASE_URL} \
    WHOIS_BASE_URL=${WHOIS_BASE_URL} \
    ARIN_API_KEY=${ARIN_API_KEY} \
    ARIN_API_KEY_SKELLY=${ARIN_API_KEY_SKELLY} \
    PALANTIR_GENERAL_HYDRA_KEY=${PALANTIR_GENERAL_HYDRA_KEY} \
    PALANTIR_GENERAL_HYDRA_KEY_SKELLY=${PALANTIR_GENERAL_HYDRA_KEY_SKELLY} \
    PALANTIR_SPIRENT_HYDRA_KEY=${PALANTIR_SPIRENT_HYDRA_KEY} \
    PALANTIR_SPIRENT_HYDRA_KEY_SKELLY=${PALANTIR_SPIRENT_HYDRA_KEY_SKELLY} \
    PALANTIR_MNE_HYDRA_KEY=${PALANTIR_MNE_HYDRA_KEY} \
    PALANTIR_MNE_HYDRA_KEY_SKELLY=${PALANTIR_MNE_HYDRA_KEY_SKELLY} \
    PALANTIR_TID_HYDRA_KEY=${PALANTIR_TID_HYDRA_KEY} \
    PALANTIR_TID_HYDRA_KEY_SKELLY=${PALANTIR_TID_HYDRA_KEY_SKELLY} \
    PALANTIR_IPC_HYDRA_KEY=${PALANTIR_IPC_HYDRA_KEY} \
    PALANTIR_IPC_HYDRA_KEY_SKELLY=${PALANTIR_IPC_HYDRA_KEY_SKELLY} \
    PALANTIR_HYDRA_STAGIUS_KEY=${PALANTIR_HYDRA_STAGIUS_KEY} \
    PALANTIR_HYDRA_STAGIUS_KEY_SKELLY=${PALANTIR_HYDRA_STAGIUS_KEY_SKELLY} \
    USAGE_DESIGNATION=${USAGE_DESIGNATION} \
    SENSE_TEST_SWAGGER_USER=${SENSE_TEST_SWAGGER_USER} \
    SENSE_TEST_SWAGGER_PASS=${SENSE_TEST_SWAGGER_PASS} \
    SENSE_TEST_SWAGGER_PASS_SKELLY=${SENSE_TEST_SWAGGER_PASS_SKELLY}

# Copy directory to container /palantir
COPY . /palantir

# Set working dir
WORKDIR /palantir

# Setting up ports to expose
EXPOSE 5003


# Install dependencies
RUN pip install --upgrade pip && \
    pip install -r requirements.txt && \
    apt-get update && \
    apt-get install fping -y && \
    apt-get install dnsutils -y && \
    apt-get install iputils-ping -y

ENTRYPOINT ["gunicorn", "-c", "gunicorn.conf.py", "run:app"]

# docker run -dp 5003:5003 --restart unless-stopped --name palantir -e SENSE_PALANTIR_CONFIG=test_config.py panamax.spectrumxg.com/service-engineering-automation/sense/palantir:<tag_name>
